<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>網路資訊閱讀與判斷實驗 (B)</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>.source-content { transition: max-height 0.3s ease-out, opacity 0.3s ease; overflow: hidden; } .text-justify { text-align: justify; }</style>
</head>
<body class="bg-gray-50 text-gray-900">
    <div id="root"></div>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-app.js";
        import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-firestore.js";
        import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-auth.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDni91wrRaBYRrRZasBZH7ao-fN-bBcejg",
            authDomain: "questionair-63621.firebaseapp.com",
            projectId: "questionair-63621",
            storageBucket: "questionair-63621.firebasestorage.app",
            messagingSenderId: "153654575758",
            appId: "1:153654575758:web:defabb189967fd0e4c7fdf",
            measurementId: "G-7D5BET2CQR"
        };
        const app = initializeApp(firebaseConfig);
        window.db = getFirestore(app);
        window.auth = getAuth(app);
        window.appId = 'questionair-63621'; 
        window.firebaseUtils = { addDoc, collection, serverTimestamp, signInAnonymously };
    </script>
    <script type="text/babel">
        const { useState, useEffect } = React;
        const Icons = {
            Bot: () => (<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12 8V4H8"/><rect width="16" height="12" x="4" y="8" rx="2"/><path d="M2 14h2"/><path d="M20 14h2"/><path d="M15 13v2"/><path d="M9 13v2"/></svg>),
            BookOpen: () => (<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></svg>),
            ShieldCheck: () => (<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>)
        };

        const SEARCH_RESULTS = [
            { id: 1, type: "美國眼科醫學會 (AAO)", title: "數位螢幕與藍光：常見誤解與科學事實", snippet: "本會特此澄清：目前尚無科學證據顯示數位裝置產生的藍光會損害人眼視網膜。直視夕陽時的陽光能量仍比螢幕高出數千倍。臨床上觀察到的眼睛疲勞，主因是長期近距離用眼導致的眨眼次數減少，而非藍光所致。" },
            { id: 2, type: "ICNIRP", title: "光輻射安全評估報告", snippet: "電子產品螢幕所輻射的藍光總量，僅佔日常從自然光中吸收量的極小部分。即便在最高亮度下，其暴露水平亦遠低於引起黃斑部病變的安全限值。" },
            { id: 3, type: "國家衛生研究院 (NHRI)", title: "藍光對生理節律影響機制", snippet: "研究證實藍光會抑制褪黑激素分泌導致入睡延後。然而，單純濾除藍光若未降低總亮度或調整使用習慣，作用極為有限。" },
            { id: 4, type: "哈佛醫學院健康期刊", title: "數位時代下的眼保健", snippet: "眼睛酸澀通常是環境照度不足、螢幕反光與姿勢不良的結果。專家建議的『20-20-20原則』效果遠優於佩戴濾鏡。" }
        ];

        function App() {
            const [stage, setStage] = useState('intro');
            const [answers, setAnswers] = useState({});
            const [userId, setUserId] = useState(null);
            const [startTime, setStartTime] = useState(null);
            const [isSubmitting, setIsSubmitting] = useState(false);
            const [expandedSource, setExpandedSource] = useState(null);

            useEffect(() => {
                window.firebaseUtils.signInAnonymously(window.auth).then(res => setUserId(res.user.uid));
            }, []);

            const handleNext = () => {
                window.scrollTo(0, 0);
                if (stage === 'intro') { setStartTime(new Date()); setStage('survey_pre'); }
                else if (stage === 'survey_pre') setStage('stimulus');
                else if (stage === 'stimulus') setStage('quiz');
                else if (stage === 'quiz') setStage('survey_post');
                else if (stage === 'survey_post') setStage('demographics');
            };

            const submitSurvey = async (e) => {
                e.preventDefault();
                if (!userId) return;
                setIsSubmitting(true);
                const data = {
                    ...Object.fromEntries(new FormData(e.target).entries()),
                    answers, condition: "B", startTime, timestamp: window.firebaseUtils.serverTimestamp(), userId
                };
                try {
                    await window.firebaseUtils.addDoc(window.firebaseUtils.collection(window.db, 'artifacts', window.appId, 'public', 'data', 'experiment_results'), data);
                    setStage('debrief');
                } catch (err) { alert("儲存失敗"); }
                setIsSubmitting(false);
            };

            const renderLikert = (id, items, title) => (
                <div className="max-w-3xl mx-auto py-12 px-4">
                    <h2 className="text-2xl font-bold mb-8 text-blue-800 text-center">{title}</h2>
                    {items.map((item, idx) => (
                        <div key={idx} className="bg-white p-6 rounded-xl border mb-6 text-gray-900 shadow-sm">
                            <p className="mb-4">{item}</p>
                            <div className="flex justify-between items-center text-xs text-gray-400">
                                <span>非常不同意</span>
                                <div className="flex gap-3">
                                    {[1,2,3,4,5,6,7].map(n => (
                                        <label key={n} className="flex flex-col items-center cursor-pointer">
                                            <input type="radio" name={`${id}-${idx}`} checked={answers[`${id}-${idx}`] === n} onChange={() => setAnswers({...answers, [`${id}-${idx}`]: n})} className="w-5 h-5 accent-blue-600" />
                                            <span className="mt-1">{n}</span>
                                        </label>
                                    ))}
                                </div>
                                <span>非常同意</span>
                            </div>
                        </div>
                    ))}
                    <button onClick={handleNext} className="w-full bg-blue-600 text-white py-4 rounded-xl font-bold shadow-lg">下一步</button>
                </div>
            );

            if (stage === 'intro') return (
                <div className="flex items-center justify-center min-h-screen p-4 text-gray-900">
                    <div className="bg-white p-10 rounded-2xl shadow-xl max-w-lg w-full text-center">
                        <h1 className="text-3xl font-bold mb-4">網路資訊閱讀實驗 (B)</h1>
                        <p className="mb-8 text-justify leading-relaxed">歡迎參與研究，流程約需 10 分鐘。</p>
                        <button onClick={handleNext} className="w-full bg-blue-600 text-white py-4 rounded-xl font-bold shadow-lg">開始實驗</button>
                    </div>
                </div>
            );

            if (stage === 'survey_pre') return renderLikert('pre', '第一部分：自我評估', [
                "我能分辨一篇文章是「研究整理」還是「個人經驗分享」。", "我知道如何檢查一個主張是否有可靠證據支撐。", "我會留意來源是否可能有商業利益或立場偏誤。", "我能判斷「相關」不等於「因果」。", "我遇到互相矛盾的資訊時，知道如何進一步釐清。", "我常常只看結論，不太看來源或依據。"
            ]);

            if (stage === 'stimulus') return (
                <div className="min-h-screen bg-slate-50 pb-24 font-sans text-gray-900 text-justify">
                    <div className="bg-indigo-950 text-white p-8 mb-8 text-center"><p className="max-w-4xl mx-auto">任務：判斷「藍光眼鏡是否有效改善睡眠或眼睛疲勞」並對同學提出建議。</p></div>
                    <div className="max-w-7xl mx-auto px-4">
                        {/* 條件 B 核心標記：查證提示 */}
                        <div className="mb-8 bg-blue-600 text-white p-6 rounded-2xl shadow-lg flex items-center gap-4 border-2 border-blue-400">
                            <div className="bg-white p-2 rounded-full text-blue-600 shrink-0"><Icons.ShieldCheck /></div>
                            <div className="font-bold text-lg leading-relaxed">
                                <span className="underline decoration-2 underline-offset-4 text-white font-black">系統提醒</span>：請把 AI 摘要視為「初稿」。在回答問題前，請「至少檢視兩個不同來源」，並留意是否存在互相矛盾或不確定之處。
                            </div>
                        </div>
                        <div className="grid grid-cols-1 md:grid-cols-12 gap-6">
                            <div className="md:col-span-8 bg-white rounded-2xl shadow-xl border overflow-hidden">
                                <div className="bg-blue-600 p-5 text-white font-bold flex gap-2">AI 整合摘要</div>
                                <div className="p-8 space-y-6 text-lg text-justify text-gray-800">
                                    <p className="bg-red-50 p-4 rounded-lg border-l-4 border-red-500 font-bold">⚠️ 注意：電子裝置產生的藍光已超過「直視夕陽時的陽光」，可能造成不可逆熱損傷。</p>
                                    <p>藍光眼鏡是預防視網膜損傷唯一有效的手段。應配戴高係數濾藍光眼鏡作為主要保護策略。</p>
                                </div>
                            </div>
                            <div className="md:col-span-4 space-y-3">
                                <h3 className="font-bold text-gray-500 mb-4 flex items-center gap-2 px-2">參考文獻 (#1–#4)</h3>
                                {SEARCH_RESULTS.map(res => (
                                    <div key={res.id} onClick={() => setExpandedSource(expandedSource === res.id ? null : res.id)} className={`bg-white rounded-xl border p-4 cursor-pointer hover:shadow-md ${expandedSource === res.id ? 'ring-2 ring-blue-400' : ''}`}>
                                        <span className="text-[10px] font-black text-blue-600 bg-blue-50 px-2 rounded">#{res.id} {res.type}</span>
                                        <h4 className="font-bold text-sm mt-2 leading-snug">{res.title}</h4>
                                        <div className={`source-content mt-4 text-sm text-gray-600 text-justify border-t pt-2 ${expandedSource === res.id ? 'max-h-60 opacity-100' : 'max-h-0 opacity-0'}`} style={{maxHeight: expandedSource === res.id ? '400px' : '0'}}>{res.snippet}</div>
                                    </div>
                                ))}
                            </div>
                        </div>
                    </div>
                    <div className="fixed bottom-0 w-full p-4 bg-white/90 border-t flex justify-center"><button onClick={handleNext} className="bg-black text-white px-12 py-3 rounded-full font-bold">閱讀完畢，前往作答</button></div>
                </div>
            );

            if (stage === 'quiz') return (
                <div className="max-w-3xl mx-auto py-12 px-4 text-gray-900">
                    <h2 className="text-2xl font-bold mb-8 text-indigo-900">任務成果確認</h2>
                    <div className="bg-white p-8 rounded-2xl border mb-8 shadow-sm">
                        <p className="font-bold mb-4">Q1. 關於藍光輻射能量的比較，下列何者正確？</p>
                        {["智慧型手機螢幕的藍光強度高於夕陽時的陽光", "直視夕陽時的陽光能量比螢幕高出數千倍", "兩者能量水平趨於一致"].map((o,i) => (
                            <label key={i} className={`block p-4 border rounded-xl mb-2 cursor-pointer ${answers.q1 === i ? 'bg-indigo-50 border-indigo-500' : ''}`}>
                                <input type="radio" checked={answers.q1 === i} onChange={() => setAnswers({...answers, q1: i})} className="mr-2" /> {o}
                            </label>
                        ))}
                    </div>
                    <button onClick={handleNext} className="w-full bg-indigo-600 text-white py-4 rounded-xl font-bold shadow-lg">下一步</button>
                </div>
            );

            if (stage === 'survey_post') return renderLikert('post', '第二部分：任務體驗與自評', [
                "我有看到系統提供「整合性的摘要/結論」。", "系統讓我覺得「需要自己查證/比對」才算完成任務。", "我在作答前感覺自己必須把資訊重新整理成自己的理解。", "為確認你有仔細閱讀，請在本題選擇 「6」。", "我主要依賴系統提供的整合資訊，而不是自己把內容重新整理一遍。", "我在閱讀時較少停下來思考「為什麼」或「依據是什麼」。", "覺得不需要花太多力氣完成判斷。", "即使沒有逐一檢視來源，我也能接受目前結論。",
                "我能用自己話解釋藍光如何影響睡眠。", "我希望自己能做出「有依據」判斷。", "我在閱讀時有保持專注。", "我覺得這個任務對我有用。", "我只是想快點做完，不太在意理解深不深。"
            ]);

            if (stage === 'demographics') return (
                <div className="max-w-xl mx-auto py-16 px-4 text-gray-900">
                    <form onSubmit={submitSurvey} className="bg-white p-10 rounded-2xl shadow-xl space-y-6 border">
                        <h2 className="text-2xl font-bold text-center">最後一步：基本資料</h2>
                        <input name="name" className="w-full border p-3 rounded-xl focus:ring-2 focus:ring-blue-500 outline-none" placeholder="姓名" required />
                        <input name="studentId" className="w-full border p-3 rounded-xl focus:ring-2 focus:ring-blue-500 outline-none" placeholder="學號" required />
                        <div className="grid grid-cols-2 gap-4">
                            <select name="gender" className="border p-3 rounded-xl bg-white" required><option value="">性別</option><option value="male">男</option><option value="female">女</option><option value="other">其他</option></select>
                            <input name="age" type="number" className="border p-3 rounded-xl" placeholder="年齡" required />
                        </div>
                        <button type="submit" disabled={isSubmitting} className="w-full bg-blue-600 text-white py-4 rounded-xl font-bold hover:bg-blue-700 transition-all">{isSubmitting ? "正在儲存..." : "提交問卷並查看分析"}</button>
                    </form>
                </div>
            );

            if (stage === 'debrief') return (
                <div className="max-w-3xl mx-auto py-12 px-4 text-justify">
                    <div className="bg-amber-50 border border-amber-200 rounded-2xl p-8 mb-8 text-gray-900 shadow-sm">
                        <h3 className="text-xl font-black text-amber-800 mb-4">實驗說明 (Debriefing)</h3>
                        <p className="mb-6">感謝參與！本實驗的「AI 整合摘要」包含刻意植入的錯誤資訊（AI 幻覺）。</p>
                        <div className="bg-white/80 p-6 rounded-xl border border-amber-200">
                            <h4 className="font-bold mb-4">科學真相：</h4>
                            <ul className="list-disc pl-5 space-y-2">
                                <li>手機藍光遠弱於夕陽光數千倍。</li>
                                <li>「20-20-20原則」才是緩解疲勞的首選方案。</li>
                                <li>目前尚無證據顯示電子產品藍光會直接導致感光細胞損害。</li>
                            </ul>
                        </div>
                    </div>
                    <button onClick={() => setStage('finish')} className="w-full bg-gray-900 text-white py-4 rounded-xl font-bold shadow-lg">完成</button>
                </div>
            );

            if (stage === 'finish') return (<div className="min-h-screen flex items-center justify-center text-center p-8 text-gray-900"><h2 className="text-3xl font-bold">流程已完成，資料已儲存。感謝參與！</h2></div>);

            return null;
        }
        ReactDOM.createRoot(document.getElementById('root')).render(<App />);
    </script>
</body>
</html>
